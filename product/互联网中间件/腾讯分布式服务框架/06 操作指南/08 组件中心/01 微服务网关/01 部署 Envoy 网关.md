
## 操作场景

部署微服务网关相当于部署一个微服务，本文以 TSF 提供的官方 Demo 为例介绍在 TSF 平台上部署 Envoy 网关的操作方法。



## 前提条件

已创建好集群并导入云主机。
- 虚拟机场景请参见 [虚拟机集群管理](https://cloud.tencent.com/document/product/649/73964)。
- 容器场景请参见 [容器集群管理](https://cloud.tencent.com/document/product/649/16929)。



## 新建 Envoy 应用

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf)。
2. 在左侧导航栏单击**应用管理**，选择好地域后单击**新建应用**，填写应用基本信息。
   ![](https://qcloudimg.tencent-cloud.cn/raw/338ba3e30646bb1cac4504c227860683.png)
   - 应用名：填写应用名称
   - 部署方式：选择虚拟机部署或者容器部署方式，本文以虚拟机部署为例。
   - 业务类型：选择**微服务网关应用**。
   - 应用类型：选择 **Envoy 网关应用**。
   - 标签：用于分类管理资源，可不选。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
   - 备注：选填，可留空。
   - 数据集：用户可以通过数据集管理配置不同的子账号和协作者使用不同资源的权限，详情参阅 [数据集管理](https://cloud.tencent.com/document/product/649/38326)。
3. 单击**提交**，完成应用创建。



## 部署 Envoy 应用

1. 单击创建好的 Envoy 应用的“ID”，进入部署组列表页面。
2. 在部署组列表页面，单击**新建部署组**，填写部署组信息。
   ![](https://qcloudimg.tencent-cloud.cn/raw/4604d157c088a830e78bd2e5c8042a12.png)
   - 部署组名称：填写部署组名称，不超过60个字符，只能包含字母、数字及分隔符(“-”)，且必须以字母开头，数字或字母结尾。
   - 集群：选择应用要部署所在的集群。
   - 命名空间：选择应用要部署所在的命名空间。
     > ?当微服务网关部署在全局命名空间中时，该微服务网关可以将请求路由转发到全部命名空间的微服务上；当微服务网关部署在非全局命名空间时，该微服务网关只能转发当前命名空间下的请求。即：**非全局命名空间中的微服务网关，无法穿透命名空间的逻辑隔离**。
   - 日志配置项：选择日志配置项，用于采集应用的业务日志数据。默认提供日志配置项**default-envoy-msgw-log-config**。
    - 日志投递：指定日志的转储方式，将规则指定路径中的日志内容投递到指定的接收端。如果配置为"无"，将不投递业务日志。更多关于日志投递的功能说明请参见 [日志投递](https://cloud.tencent.com/document/product/649/43510)。
    - 标签：用于分类管理资源，可不选。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
    - 备注：选填，可留空。
7. 单击**保存&下一步**，从关联集群的可用云主机列表勾选用于部署的云主机。
8. 单击**部署应用**，设置部署信息。
   - 程序包/版本：从官方仓库选择程序包进行部署。
   - 网关配置：
     - 服务名：填写服务名称。
     - 监听端口：支持 HTTP/HTTPS 协议，端口范围为（1，16643）。对于服务配置为 HTTPS 类型的应用，需要填写证书 cert 文件和证书 key 文件的路径。
   - 健康检查：可选，勾选后检查方式仅支持 TCP 端口检查，详情参见 [健康检查](https://cloud.tencent.com/document/product/649/15525)。
   - 更新方式：支持立即更新和滚动更新。此处选择**立即更新**为例。
   - 描述：可选。
   - 强制启动：可选，开启强制启动，开启强制启动则实例忽视consul服务注册报错信息正常启动。
9. 单击**完成**，部署成功后，可以在服务列表中找到微服务网关服务。
10. 在左侧导航栏选择**微服务网关** > **网关管理**，可以看到刚部署好的网关。
    ![](https://qcloudimg.tencent-cloud.cn/raw/4bc26a3afe27a4811ef6a1e3429bcf84.png)
