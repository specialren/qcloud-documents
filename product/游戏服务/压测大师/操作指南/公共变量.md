本文主要介绍如何在压测计划里定义公共变量和引用已定义好的公共变量。

## 概览
在编排压测场景中，可将重复引用的内容定义为公共变量，便于压测计划的修改。平台提供的公共变量类型如下：

|类型 | 说明 | 生效范围 |
|------|------|------|
| 全局自定义变量 | 通过定义变量，便于接口引用 | 当前整个压测计划 |
| 全局文件变量 | 通过绑定 csv 文件，准备测试数据 | 当前整个压测计划 |
| 链路自定义变量 | 通过定义变量，便于接口引用 | 当前链路 |
| 链路文件变量 | 通过绑定 csv 文件，准备测试数据 | 当前链路 |


## 自定义变量
变量名需要以字母开头，由数字、字母和下划线组成；变量内容支持由字符串和公共函数组合。

### 全局自定义变量
如需在整个压测计划中频繁使用某个变量，可定义全局自定义变量。在压测计划中选择**全局配置 > 全局变量 > 自定义变量**，单击**添加变量**，定义全局自定义变量。
![](https://qcloudimg.tencent-cloud.cn/raw/0b82d7b3bef1bb6e63f8107b010e91a1.png)


### 链路自定义变量
如需在指定链路下频繁使用某个变量，可定义链路自定义变量。执行链路、前置处理、后置处理均支持定义链路自定义变量。在指定链路选择**链路变量 > 自定义变量**。
![](https://qcloudimg.tencent-cloud.cn/raw/af0daa68c6f38b9e8203cc5a325c031a.png)
单击**添加变量**，定义链路自定义变量。
![](https://qcloudimg.tencent-cloud.cn/raw/444138d4589251f667aaeb133153d7d7.png)

## 文件变量
在压测过程中如需大量测试数据（例如 cookie，orderID 等），可通过绑定 csv 文件从而定义文件变量实现。

### 全局文件变量
对于多条链路可共享的测试数据，推荐使用全局文件变量。

1. 在压测计划中选择**全局配置 > 全局变量 > 文件变量**。
2. 单击**添加文件**，绑定包含测试数据的 csv 文件。
![](https://qcloudimg.tencent-cloud.cn/raw/0cd75aacd721fcbe15aca8eaf32a85d8.png)
3. 在弹窗中选择需要绑定的 csv 文件即可。
![](https://qcloudimg.tencent-cloud.cn/raw/2434e1c39742ee5d4fd4bfff655be72c.png)

**其他方式：**
- 单击**上传文件**，然后绑定最新上传的 csv 文件。
- 单击**构造数据**，跳转到**测试数据管理**模块。通过从数据源构造测试数据，自动生成 csv 文件，即可绑定该压测计划。

文件相关配置如下：

| 配置项 | 说明 | 默认值 |
|------|------|------|
| 读取方式 | 从文件读取测试数据的方式，顺序读取或随机读取 | 顺序 |
| 轮询设置 | 从文件读取测试数据的次数，循环读取或仅读取一次 | 循环执行 |
| 切分文件 | 指各压力机被分配到的文件形式。如果选择切分文件，分配给各压力机的数据片段不重复；否则，每台压力机得到的均是完整文件。 | 不切分 |

通过重新定义文件内各变量名称，避免与其他自定义变量重名。也可与原变量名保持一致。
![](https://qcloudimg.tencent-cloud.cn/raw/da82af8b6aec4717033ee4de1f08091c.png)

>!如果已绑定的 csv 文件被删除，需要在对应压测计划中移除该文件，方可正常执行压测任务。

### 链路文件变量
对于仅一条链路下接口共用的测试数据，可在指定链路配置文件变量。
在指定链路选择 **链路变量 > 文件变量**，单击**添加文件**，绑定包含测试数据的 csv 文件。
![](https://qcloudimg.tencent-cloud.cn/raw/2102d276de16782ed494fb9cbd4c96f5.png)

## 引用公共变量
在压测计划中多处可引用公共变量，其中包括：请求 URL、请求头、请求体、请求参数、请求结果断言、前置处理器、后置处理器等。
在填写接口请求信息时，可通过**引用变量**选择所需的变量。
![](https://qcloudimg.tencent-cloud.cn/raw/04e29f7f6da33e8093fe2d023b657053.png)
选择所需变量，单击**复制**。
![](https://qcloudimg.tencent-cloud.cn/raw/d01d9c2030d9810363d7001bd44c6d63.png)
在所需变量的编辑框**粘贴**即可。
![](https://qcloudimg.tencent-cloud.cn/raw/684b8777b24217895a0837f9c9f87cc0.png)

## 公共变量运行结果
对于在压测计划中定义的所有变量，均可在调试日志或采样日志中查看运行到指定接口时的变量值。

在配置好压测计划后，单击**调试/执行**，指定调试日志或采样日志中的接口，选择**公共变量**。
>!如果多处定义的变量名重名，变量值会按照优先级进行覆盖。
